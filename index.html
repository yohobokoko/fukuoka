<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹å®¶åŒ—ä¹å·å…­æ—¥è¡Œ | äº’å‹•æ—…è¡Œæ‰‹å¸³ (å¯ç·¨è¼¯ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Chosen Palette: [Warm Ghibli Journal] */
        :root {
            --bg-paper: #fcf9ee;
            --text-ink: #4a4a4a;
            --primary-accent: #d97706; /* Warm Orange */
            --secondary-accent: #84cc16; /* Soft Green */
        }

        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-paper);
            color: var(--text-ink);
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }

        /* Card Hover Effects */
        .hover-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .hover-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* Filter Button Active State */
        .filter-btn.active { background-color: var(--primary-accent); color: white; border-color: var(--primary-accent); }
        
        /* Sketch Box Style */
        .sketch-box { border: 2px dashed #d97706; border-radius: 1rem; position: relative; background: #fff; }
        .sketch-pin { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 20px; height: 20px; background: #ef4444; border-radius: 50%; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); z-index: 10; }

        /* Image Styling */
        .sketch-img-container { overflow: hidden; border: 6px solid #fff; border-radius: 2px 255px 3px 25px / 255px 5px 225px 5px; box-shadow: 5px 5px 15px rgba(0,0,0,0.15); transition: transform 0.3s ease; position: relative; background: #fff; }
        .sketch-img-container:hover { transform: scale(1.02) rotate(1deg); }
        img { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.2) contrast(1.1); }
        .img-label { position: absolute; bottom: 10px; right: 10px; background: rgba(255, 255, 255, 0.9); color: #574c3e; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; box-shadow: 1px 1px 3px rgba(0,0,0,0.2); }

        /* Fade Animation */
        .fade-enter { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Chat Widget Styles */
        #chat-widget { position: fixed; bottom: 90px; right: 20px; width: 350px; height: 500px; background: white; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.25); display: none; flex-direction: column; z-index: 100; overflow: hidden; border: 1px solid #e2e8f0; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        #chat-header { background: linear-gradient(135deg, #d97706, #b45309); color: white; padding: 16px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        #chat-messages { flex: 1; padding: 16px; overflow-y: auto; background: #fffbef; display: flex; flex-direction: column; gap: 12px; }
        #chat-input-area { padding: 12px; border-top: 1px solid #e6dbb8; display: flex; gap: 8px; background: white; }
        .message { max-width: 85%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .user-msg { background: #d97706; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .ai-msg { background: #fff; color: #574c3e; border: 1px solid #e6dbb8; align-self: flex-start; border-bottom-left-radius: 2px; }
        .typing-indicator { font-style: italic; color: #6b7280; font-size: 0.75rem; margin-left: 16px; margin-bottom: 8px; display: none; }
        #ai-toggle-btn { position: fixed; bottom: 100px; right: 20px; background: linear-gradient(135deg, #d97706, #f59e0b); color: white; width: 56px; height: 56px; border-radius: 50%; box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 99; transition: all 0.2s; font-size: 24px; }
        #ai-toggle-btn:hover { transform: scale(1.1); }

        /* Print Hiding */
        @media print {
            body { background-color: white; background-image: none; }
            .no-print { display: none !important; }
            #chat-widget, #ai-toggle-btn { display: none !important; }
        }

        /* Edit Mode Styles */
        .edit-input { border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.25rem 0.5rem; width: 100%; font-size: 0.875rem; color: #4a4a4a; margin-bottom: 0.25rem; }
        .edit-input:focus { outline: none; border-color: #d97706; ring: 2px solid #d97706; }
        .edit-textarea { width: 100%; min-height: 80px; resize: vertical; }
        .delete-btn { position: absolute; top: -10px; right: -10px; background: #ef4444; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 20; }
    </style>
    <script>
        function imgError(image) {
            const container = image.closest('.sketch-img-container');
            if (container) container.style.display = 'none';
            return true;
        }
    </script>
</head>
<body>

    <!-- Header Actions -->
    <div class="fixed top-4 right-4 no-print z-50 flex gap-2">
        <button id="edit-toggle-btn" onclick="toggleEditMode()" class="bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-700 flex items-center gap-2 font-bold transition text-sm">
            âœï¸ ç·¨è¼¯è¡Œç¨‹
        </button>
        <button onclick="downloadJson()" class="bg-gray-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-gray-700 flex items-center gap-2 font-bold transition text-sm" title="å‚™ä»½è¨­å®š">
            ğŸ“¥ å‚™ä»½
        </button>
         <label for="upload-json" class="bg-gray-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-gray-700 flex items-center gap-2 font-bold transition text-sm cursor-pointer" title="é‚„åŸè¨­å®š">
            ğŸ“¤ é‚„åŸ
            <input type="file" id="upload-json" accept=".json" class="hidden" onchange="uploadJson(this)">
        </label>
        <button onclick="window.print()" class="bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg hover:bg-gray-900 flex items-center gap-2 font-bold transition text-sm">
            ğŸ–¨ï¸ åˆ—å°
        </button>
    </div>

    <!-- AI Toggle Button -->
    <div id="ai-toggle-btn" class="no-print" onclick="toggleChat()">âœ¨</div>

    <!-- AI Chat Widget -->
    <div id="chat-widget" class="no-print">
        <div id="chat-header">
            <div class="flex items-center gap-2"><span>ğŸ¤– ç‹å®¶æ—…éŠ AI å°éŠ</span></div>
            <button onclick="toggleChat()" class="text-white hover:text-gray-200 text-xl font-bold">&times;</button>
        </div>
        <div id="chat-messages">
            <div class="message ai-msg">
                å“ˆå›‰ï¼æˆ‘æ˜¯æ‚¨çš„ä¹å· AI å°éŠã€‚<br>
                é€™å€‹ç‰ˆæœ¬å¯ä»¥è®“æ‚¨<b>è‡ªç”±ç·¨è¼¯</b>è¡Œç¨‹æ–‡å­—å’Œåœ–ç‰‡å–”ï¼<br>
                é»æ“Šå³ä¸Šè§’çš„ã€Œâœï¸ ç·¨è¼¯è¡Œç¨‹ã€è©¦è©¦çœ‹å§ï¼ğŸŒ¿
            </div>
        </div>
        <div class="typing-indicator" id="typing-indicator">Gemini æ­£åœ¨æŸ¥è©¢...</div>
        <div id="chat-input-area">
            <input type="text" id="user-input" class="flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500" placeholder="ä¾‹å¦‚ï¼šç”±å¸ƒé™¢ä¹‹æ£®åœ¨å“ªæ­ï¼Ÿ..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-yellow-700 font-medium">é€å‡º</button>
        </div>
    </div>

    <div class="page-container" id="brochure-content">
        <!-- Cover -->
        <div class="text-center border-b-2 border-dashed border-gray-300 pb-8 mb-8 relative pt-10">
            <h1 class="text-4xl font-bold text-yellow-900 mb-2 tracking-wide">ç‹å®¶åŒ—ä¹å·å…­æ—¥è¡Œ</h1>
            <p class="text-gray-600 text-lg font-medium">å¤§åˆ† âœ• åˆ¥åºœ âœ• æŸ³å· âœ• ç¦å²¡</p>
        </div>

        <nav class="flex gap-2 mb-6">
            <button onclick="switchView('info')" class="nav-btn bg-orange-100 text-orange-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-orange-200 transition">â„¹ï¸ æ—…ç¨‹é‡é»</button>
            <button onclick="switchView('itinerary')" class="nav-btn bg-white text-gray-600 border border-gray-200 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-50 transition">ğŸ“… è©³ç´°è¡Œç¨‹</button>
            <button onclick="switchView('souvenir')" class="nav-btn bg-white text-gray-600 border border-gray-200 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-50 transition">ğŸ å¿…è²·ä¼´æ‰‹ç¦®</button>
        </nav>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Sidebar -->
            <aside class="lg:col-span-3 space-y-6">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 sticky top-24">
                    <h3 class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-3">é¸æ“‡å¤©æ•¸</h3>
                    <div class="grid grid-cols-2 gap-2 lg:grid-cols-1" id="day-nav"></div>
                </div>
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 hidden lg:block sticky top-[450px]">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-gray-500 text-xs font-bold uppercase tracking-wider">è¡Œææª¢æŸ¥</h3>
                        <span id="pack-progress" class="text-xs font-bold text-orange-500">0/0</span>
                    </div>
                    <ul id="packing-list-sidebar" class="space-y-2 max-h-60 overflow-y-auto text-sm"></ul>
                    <div id="add-pack-item-container" class="mt-2 hidden">
                        <input type="text" id="new-pack-item" placeholder="æ–°å¢ç‰©å“..." class="edit-input" onkeypress="if(event.key==='Enter') addPackItem()">
                    </div>
                </div>
            </aside>

            <!-- Content -->
            <section class="lg:col-span-9 space-y-6" id="main-content">
                <!-- Content injected here -->
            </section>
        </main>

        <footer class="text-center text-xs text-gray-400 mt-10 mb-20">
            * åœ–ç‰‡ä¾†æºï¼šWikimedia Commons (Public Domain / CC-BY)ï¼Œä¸¦å¥—ç”¨ CSS æ¿¾é¡æ¨¡æ“¬æ‰‹ç¹ªé¢¨æ ¼ã€‚
        </footer>
    </div>

    <!-- Templates -->
    <template id="info-template">
        <div class="space-y-6 animate-fade-in fade-enter">
            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-3xl p-8 border border-orange-200 relative overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-3xl font-bold text-orange-900 mb-4">æ—…ç¨‹æ¦‚è¦½</h2>
                    <p class="text-orange-800 opacity-90 leading-relaxed text-lg">
                        é€™æ˜¯ä¸€è¶Ÿç‚ºç‹å®¶é‡èº«æ‰“é€ çš„å…­æ—¥åŒ—ä¹å·ä¹‹æ—…ã€‚æˆ‘å€‘å°‡é€ è¨ªå¤§åˆ†ã€åˆ¥åºœã€ç”±å¸ƒé™¢ã€æŸ³å·èˆ‡ç¦å²¡ã€‚<br>
                        è¡Œç¨‹åŒ…å«äº†æº«æ³‰ã€è§€å…‰åˆ—è»Šã€éŠèˆ¹ä»¥åŠç•¶åœ°çš„ç‰¹è‰²ç¾é£Ÿã€‚<br>
                        è«‹æ”¾æ…¢è…³æ­¥ï¼Œäº«å—é€™æ®µç¾å¥½çš„æ—…ç¨‹ã€‚
                    </p>
                </div>
                <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-orange-200 rounded-full opacity-50 blur-2xl"></div>
            </div>

            <!-- Integrated Info Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-5 rounded-2xl border-2 border-dashed border-yellow-200 shadow-sm">
                    <h3 class="font-bold text-yellow-800 mb-3 flex items-center text-lg">ğŸ¨ ä½å®¿å°å±‹</h3>
                    <div class="mb-4 pl-2 border-l-4 border-pink-300">
                        <span class="text-xs font-bold text-pink-600">Day 1-2</span>
                        <p class="font-bold mt-1 text-gray-800">JR Kyushu Hotel Blossom Oita</p>
                        <p class="text-sm text-gray-500">JRå¤§åˆ†ç«™ç›´çµã€‚é ‚æ¨“éœ²å¤©æº«æ³‰è¶…è®šï¼</p>
                    </div>
                    <div class="pl-2 border-l-4 border-blue-300">
                        <span class="text-xs font-bold text-blue-600">Day 3-5</span>
                        <p class="font-bold mt-1 text-gray-800">ä¸‰äº•èŠ±åœ’é£¯åº—ç¦å²¡ç¥‡åœ’</p>
                        <p class="text-sm text-gray-500">åšå¤šç«™æ­¥è¡Œ7åˆ†ï¼Œåšå¤šé‹æ²³åŸæ—ã€‚</p>
                    </div>
                </div>
                <div class="bg-white p-5 rounded-2xl border-2 border-dashed border-yellow-200 shadow-sm">
                    <h3 class="font-bold text-yellow-800 mb-3 flex items-center text-lg">ğŸ›« äº¤é€šèˆ‡ç¥¨åˆ¸</h3>
                    <ul class="text-sm space-y-3 text-gray-600">
                        <li class="flex justify-between items-center border-b border-gray-100 pb-2">
                            <span>æŠµé”ç¦å²¡ï¼š</span>
                            <span class="font-bold text-gray-900 bg-gray-100 px-2 py-1 rounded">11:15</span>
                        </li>
                        <li class="flex justify-between items-center border-b border-gray-100 pb-2">
                            <span>é›¢é–‹ç¦å²¡ï¼š</span>
                            <span class="font-bold text-gray-900 bg-gray-100 px-2 py-1 rounded">15:55</span>
                        </li>
                        <li class="pt-1">
                            <p class="font-bold text-gray-800 mb-1">ğŸ« é‡é»ç¥¨åˆ¸</p>
                            <ul class="list-disc pl-5 space-y-1 text-xs">
                                <li><b>Day 3 ç”±å¸ƒé™¢ä¹‹æ£®</b> (éœ€æå‰åŠƒä½)</li>
                                <li><b>Day 4 å¤ªå®°åºœæŸ³å·å¥—ç¥¨</b> (è¥¿éµå¤©ç¥ç«™è²·)</li>
                                <li>å…¶é¤˜äº¤é€šä½¿ç”¨ JR è»Šç¥¨æˆ– IC å¡</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Sketch Note -->
            <div class="sketch-box p-6 mt-6">
                <div class="sketch-pin"></div>
                <h3 class="font-bold text-gray-700 mb-2 text-center">ğŸ’ å¿…å¸¶ç‰©å“æé†’</h3>
                <div class="text-sm text-gray-600 text-center leading-relaxed space-y-1">
                    <p>âœ… <b>è­·ç…§</b> (æ•ˆæœŸéœ€6å€‹æœˆä»¥ä¸Š)</p>
                    <p>âœ… <b>VJW æˆªåœ–</b> (å…¥å¢ƒå¯©æŸ¥ç”¨)</p>
                    <p>âœ… <b>æ—¥å¹£ç¾é‡‘</b> (æ­èˆ¹ã€å±‹å°ã€å°åº—ç”¨)</p>
                    <p>âœ… <b>å¥½èµ°çš„é‹å­</b> (æ¯å¤©éƒ½è¦èµ°å¾ˆå¤šè·¯ï¼)</p>
                </div>
            </div>
        </div>
    </template>

    <template id="itinerary-template">
        <div class="space-y-6 animate-fade-in fade-enter">
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-orange-100 rounded-full mix-blend-multiply filter blur-3xl opacity-50 transform translate-x-10 -translate-y-10"></div>
                <h2 id="day-title" class="text-3xl font-bold text-gray-800 relative z-10">Day 1</h2>
                <p id="day-desc" class="text-gray-500 mt-2 relative z-10 font-medium text-lg">Loading...</p>
                <div class="mt-4 flex gap-2" id="day-tags"></div>
            </div>
            
            <!-- Timeline -->
            <div class="relative space-y-4 before:content-[''] before:absolute before:left-[52px] md:before:left-[60px] before:top-4 before:bottom-4 before:w-0.5 before:bg-gray-200" id="timeline-container"></div>

            <!-- Add Button (Edit Mode) -->
            <button id="add-activity-btn" class="hidden w-full py-3 rounded-xl border-2 border-dashed border-gray-300 text-gray-500 hover:border-orange-400 hover:text-orange-500 transition font-bold" onclick="addActivity()">
                + æ–°å¢è¡Œç¨‹
            </button>
            
            <!-- Navigation Footer -->
            <div class="flex justify-between mt-8 pt-4 border-t border-gray-100" id="timeline-nav-footer"></div>
        </div>
    </template>

    <template id="souvenir-template">
        <div class="space-y-6 animate-fade-in fade-enter">
            <div class="bg-gradient-to-br from-pink-50 to-orange-50 rounded-3xl p-8 border border-pink-200 relative overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-3xl font-bold text-pink-900 mb-4">ğŸ ä¹å·å¿…è²·ä¼´æ‰‹ç¦®</h2>
                    <p class="text-pink-800 opacity-90 leading-relaxed text-lg">é€™è£¡ç²¾é¸äº†ç¦å²¡èˆ‡ä¹å·æœ€å—æ­¡è¿çš„ä¼´æ‰‹ç¦®æ¸…å–®ã€‚</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Sweet Classics -->
                <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm hover-card">
                    <h3 class="font-bold text-lg text-gray-800 mb-2 border-b pb-2 border-gray-100">ğŸ° ç¶“å…¸ç”œé»</h3>
                    <ul class="space-y-4">
                        <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸŒ•</span>
                            <div><h4 class="font-bold text-gray-700">æ˜æœˆå ‚ åšå¤šé€šé¥…é ­</h4><p class="text-xs text-gray-500">é€£çºŒç²ççš„ç¦å²¡ä»£è¡¨éŠ˜è“ï¼Œç™½è±†æ²™é¤¡å¥¶é¦™æ¿ƒéƒã€‚</p></div>
                        </li>
                         <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸ®</span>
                            <div><h4 class="font-bold text-gray-700">å¦‚æ°´åºµ ç­‘ç´«éº»ç³¬</h4><p class="text-xs text-gray-500">è³ªæ„Ÿçˆ†æ£šçš„æ—¥å¼é»å¿ƒï¼Œæ’’ä¸Šé»ƒè±†ç²‰æ·‹ä¸Šé»‘ç³–èœœã€‚</p></div>
                        </li>
                        <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸ¤</span>
                            <div><h4 class="font-bold text-gray-700">å‰é‡å ‚ å°é›é¥…é ­</h4><p class="text-xs text-gray-500">é€ å‹å¯æ„›çš„å°é›ï¼Œå…§åŒ…ç¶¿å¯†é»ƒè±†æ²™ï¼Œç¶“å…¸ä¸æ•—ã€‚</p></div>
                        </li>
                        <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸ“</span>
                            <div><h4 class="font-bold text-gray-700">AMANBERRY è‰è“å¥¶æ²¹é¤…ä¹¾</h4><p class="text-xs text-gray-500">æ–°æ™‰äººæ°£ç‹ï¼è²“èˆŒé¤…ä¹¾å¤¾è‘—ç”˜ç‹è‰è“ç™½å·§å…‹åŠ›ã€‚</p></div>
                        </li>
                    </ul>
                </div>

                <!-- Savory & Snacks -->
                <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm hover-card">
                    <h3 class="font-bold text-lg text-gray-800 mb-2 border-b pb-2 border-gray-100">ğŸ˜ é¹¹é£Ÿ & ä¸‹é…’èœ</h3>
                    <ul class="space-y-4">
                        <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸ¦</span>
                            <div><h4 class="font-bold text-gray-700">ç¦å¤ªéƒ æ˜å¤ªå­ä»™è² (Menbei)</h4><p class="text-xs text-gray-500">ç¦å²¡æœ€å¤¯ä¼´æ‰‹ç¦®ä¹‹ä¸€ï¼é…¥è„†å¾®è¾£ï¼Œæµ·é®®å‘³æ¿ƒéƒã€‚</p></div>
                        </li>
                         <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸŒ¯</span>
                            <div><h4 class="font-bold text-gray-700">åƒé³¥å±‹æœ¬å®¶ æ²å¿ƒé…¥</h4><p class="text-xs text-gray-500">Tirolian æ²å¿ƒé…¥ï¼ŒåŒ…è‘—é¦™è‰ã€å’–å•¡ç­‰å¥¶æ²¹é¤¡ã€‚</p></div>
                        </li>
                        <li class="flex gap-3 items-center">
                            <span class="text-2xl">ğŸ</span>
                            <div><h4 class="font-bold text-gray-700">äºŒé¶´å ‚ åšå¤šä¹‹å¥³</h4><p class="text-xs text-gray-500">å¹´è¼ªè›‹ç³•åŒ…è‘—ç´…è±†ç¾Šç¾¹ï¼Œå£æ„Ÿæ¿•æ½¤ï¼Œåšå¤šå‚³çµ±ç¾å‘³ã€‚</p></div>
                        </li>
                    </ul>
                </div>

                <!-- Seasoning & Ramen -->
                <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm hover-card md:col-span-2">
                    <h3 class="font-bold text-lg text-gray-800 mb-2 border-b pb-2 border-gray-100">ğŸœ èª¿å‘³èˆ‡æ‹‰éºµ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <ul class="space-y-4">
                            <li class="flex gap-3 items-center">
                                <span class="text-2xl">ğŸœ</span>
                                <div><h4 class="font-bold text-gray-700">ä¸€è˜­æ‹‰éºµ / åšå¤šæ‹‰éºµåŒ…</h4><p class="text-xs text-gray-500">é›–ç„¶å°ç£æœ‰è³£ï¼Œä½†ç¦å²¡é™å®šå£å‘³å€¼å¾—å¸¶ï¼</p></div>
                            </li>
                            <li class="flex gap-3 items-center">
                                <span class="text-2xl">ğŸŒ¶ï¸</span>
                                <div><h4 class="font-bold text-gray-700">æŸšå­èƒ¡æ¤’</h4><p class="text-xs text-gray-500">ä¹å·ç‰¹ç”¢èª¿å‘³æ–™ï¼Œæ¸…æ–°çš„æŸšå­é¦™å¸¶é»è¾£ã€‚</p></div>
                            </li>
                        </ul>
                        <ul class="space-y-4">
                            <li class="flex gap-3 items-center">
                                <span class="text-2xl">ğŸŸ</span>
                                <div><h4 class="font-bold text-gray-700">YAMAYA è»Ÿç®¡æ˜å¤ªå­é†¬</h4><p class="text-xs text-gray-500">è¶…æ–¹ä¾¿ï¼æ“ å‡ºä¾†å°±èƒ½é…é£¯ã€å¡—éºµåŒ…ã€‚</p></div>
                            </li>
                            <li class="flex gap-3 items-center">
                                <span class="text-2xl">ğŸ¥š</span>
                                <div><h4 class="font-bold text-gray-700">çŸ³æ‘è¬ç››å ‚ é¶´ä¹ƒå­</h4><p class="text-xs text-gray-500">ç™¾å¹´è€åº—ï¼Œåƒæ°´ç…®è›‹ä¸€æ¨£å¯æ„›çš„æ£‰èŠ±ç³–ç”œé»ã€‚</p></div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-sm text-yellow-800 text-center mt-4">
                ğŸ’¡ <b>å°æ’‡æ­¥ï¼š</b> å¤§éƒ¨åˆ†ä¼´æ‰‹ç¦®åœ¨ <b>ç¦å²¡æ©Ÿå ´å…ç¨…åº—</b> éƒ½è²·å¾—åˆ°ï¼Œå»ºè­°æœ€å¾Œä¸€å¤©å†ä¸€æ¬¡è²·é½Šï¼
            </div>
        </div>
    </template>

    <script>
        // --- Default Data ---
        const defaultTripData = {
            days: [
                {
                    day: 1,
                    title: "æŠµé”ä¹å· & æ©Ÿå ´æ‹‰éºµåˆé¤",
                    focus: "ä¹å·ä¹‹æ—…å•Ÿç¨‹ï¼ğŸœ æ©Ÿå ´æ‹‰éºµååº—å·¡ç¦® â” ğŸš„ æ­ä¹˜è—è‰²éŸ³é€Ÿè™Ÿå¥”é¦³ â” ğŸ¥© å¤§åˆ†å¸‚å€äº«ç”¨è±å¾Œç‰›æ™šé¤",
                    tags: ["ç§»å‹•æ—¥", "ç¾é£Ÿ", "æ‹‰éºµ"],
                    activities: [
                        { time: "11:15", title: "æŠµé”ç¦å²¡æ©Ÿå ´", type: "transport", desc: "å‡ºé—œç´„ 40-60 åˆ†é˜ï¼Œæ­æ¥é§è»Šè‡³ã€Œåœ‹å…§ç·šèˆªå»ˆã€3Fã€‚", icon: "ğŸ›¬" },
                        { time: "12:15", title: "åˆé¤ï¼šæ‹‰éºµæ»‘èµ°è·¯", type: "food", desc: "å°±åœ¨æ©Ÿå ´å…§ï¼ŒåŒ¯é›†ä¹å·ååº—ï¼Œé †è·¯å…ˆåƒå†èªªï¼", icon: "ğŸœ", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Hakata_ramen_by_gusa_in_Kyoto.jpg/640px-Hakata_ramen_by_gusa_in_Kyoto.jpg" },
                        { time: "14:00", title: "åšå¤šç«™ï¼šè³¼è²·è»Šç¥¨", type: "transport", desc: "å‰å¾€ç¶ è‰²çª—å£è³¼è²·å¾€å¤§åˆ†çš„ç‰¹æ€¥åˆ¸ (Sonic è™Ÿ)ã€‚", icon: "ğŸš‰" },
                        { time: "15:00", title: "ç§»å‹•ï¼šå‰å¾€å¤§åˆ†", type: "transport", desc: "æ­ä¹˜ JR éŸ³é€Ÿè™Ÿ (Sonic) ç´„ 2 å°æ™‚ 15 åˆ†ã€‚å°æ’‡æ­¥ï¼šåœ¨å°å€‰ç«™è¨˜å¾—å°‡åº§æ¤…æ—‹è½‰ 180 åº¦ã€‚", icon: "ğŸš„", image: "https://upload.wikimedia.org/wikipedia/commons/f/f6/JR_Kyushu_883_series_renewed_Sonic.jpg" },
                        { time: "17:15", title: "é£¯åº— Check-in", type: "stay", desc: "JR Kyushu Hotel Blossom Oita (è»Šç«™ç›´çµ)ï¼Œå…ˆä¼‘æ¯ä¸€ä¸‹ã€‚", icon: "ğŸ¨" },
                        { time: "19:00", title: "å¸‚å€æ™šé¤", type: "food", desc: "å‰å¾€å¤§åˆ†å¸‚å€ï¼ˆä¸­å¤®ç”ºå•†åº—è¡—ï¼‰ï¼Œæ¨è–¦äº«ç”¨è±å¾Œç‰›æˆ–åœ¨åœ°å±…é…’å±‹ã€‚", icon: "ğŸ½ï¸" }
                    ]
                },
                {
                    day: 2,
                    title: "æ…¢éŠç«¥è©±å°é®ï¼šç”±å¸ƒé™¢",
                    focus: "é‡‘é±—æ¹–æ™¨éœ§/ç¾æ™¯ã€æ¹¯ä¹‹åªè¡—é“ç”œé»ã€é‡œé£¯",
                    tags: ["è‡ªç„¶", "æ•£ç­–", "ç”œé»"],
                    activities: [
                        { time: "08:30", title: "é£¯åº—æ—©é¤", type: "food", desc: "å‹™å¿…äº«ç”¨ï¼é€™å®¶æ—©é¤è©•åƒ¹æ¥µé«˜ã€‚", icon: "ğŸ¥" },
                        { time: "09:30", title: "å‰å¾€ç”±å¸ƒé™¢", type: "transport", desc: "æ­ä¹˜ JR ä¹…å¤§æœ¬ç·š (ç´„ 50åˆ† - 1å°æ™‚)ã€‚", icon: "ğŸš‚", image: "https://upload.wikimedia.org/wikipedia/commons/9/91/Yufuin_Station_2012.JPG" },
                        { time: "10:30", title: "æ¹¯ä¹‹åªè¡—é“æ•£ç­–", type: "sightseeing", desc: "å¿…åƒï¼šB-Speak è›‹ç³•æ²ã€é‡‘è³å¯æ¨‚é¤…ã€å²åŠªæ¯”èŒ¶å±‹ã€‚", icon: "ğŸ°" },
                        { time: "12:00", title: "åˆé¤ï¼šé‡œé£¯", type: "food", desc: "æ¨è–¦ï¼šç”±å¸ƒç‘ªå¸ƒå¸Œ å¿ƒ (Yufu Mabushi Shin)ï¼Œè±å¾Œç‰›é‡œé£¯ä¸‰åƒã€‚", icon: "ğŸ²" },
                        { time: "13:30", title: "ç«¥è©±æ‘ / æ˜­å’Œé¤¨", type: "sightseeing", desc: "Yufuin Floral Village (åƒå‰åœåŠ›/å“ˆåˆ©æ³¢ç‰¹å ´æ™¯)ã€‚", icon: "ğŸŒ¸" },
                        { time: "15:00", title: "é‡‘é±—æ¹–", type: "sightseeing", desc: "ä¸‹åˆå…‰ç·šæŸ”å’Œï¼Œæ²¿è‘—æ¹–ç•”æ­¥é“æ•£æ­¥éå¸¸æ„œæ„ã€‚", icon: "ğŸ“¸", image: "https://upload.wikimedia.org/wikipedia/commons/c/c3/Kinrin_Lake_in_morning.jpg" },
                        { time: "16:00", title: "æ¹–ç•”ä¸‹åˆèŒ¶", type: "food", desc: "æ¨è–¦ï¼šCafe La Ruche æˆ– Chagal ç¾è¡“é¤¨å’–å•¡å»³ã€‚", icon: "â˜•" },
                        { time: "17:30", title: "è¿”å›å¤§åˆ†", type: "transport", desc: "æ­ä¹˜ JR è¿”å›å¤§åˆ†ç«™ã€‚", icon: "ğŸš„" },
                        { time: "19:00", title: "æ™šé¤ï¼šå¤§åˆ†å¸‚å€", type: "food", desc: "åœ¨å¤§åˆ†ä¸­å¤®é€šå•†åº—è¡—æ‰¾é–“å±…é…’å±‹é«”é©—åœ¨åœ°æ°£æ°›ã€‚", icon: "ğŸ¢" }
                    ]
                },
                {
                    day: 3,
                    title: "åˆ¥åºœåœ°ç„ â” è—¥é™¢ç‡’è‚‰",
                    focus: "åˆ¥åºœåœ°ç„ç²¾è¯ã€åœ°ç„è’¸æ–™ç†ã€ç”±å¸ƒé™¢ä¹‹æ£®å›ç¨‹ã€ç‡’è‚‰å¤§é¤",
                    tags: ["åœ°ç„æº«æ³‰", "è§€å…‰åˆ—è»Š", "ç‡’è‚‰"],
                    activities: [
                        { time: "09:00", title: "é€€æˆ¿ Check-out", type: "transport", desc: "å¸¶è‘—è¡Œææ­ä¹˜ JR è‡³åˆ¥åºœç«™ (15åˆ†é˜)ï¼Œè¡Œæå¯„æ”¾è»Šç«™ã€‚", icon: "ğŸ‘‹" },
                        { time: "10:00", title: "åœ°ç„æº«æ³‰å·¡ç¦®", type: "sightseeing", desc: "æ­å·´å£«è‡³ã€Œæµ·åœ°ç„å‰ã€ï¼Œåƒè§€ æµ·åœ°ç„ (æœ€ç¾)ã€ç¶åœ°ç„ (äº’å‹•å¤š)ã€‚", icon: "ğŸ‘¹", image: "https://upload.wikimedia.org/wikipedia/commons/e/ee/Beppu_umijigoku.jpg" },
                        { time: "12:00", title: "åˆé¤ï¼šåœ°ç„è’¸", type: "food", desc: "åœ°ç„è’¸å·¥æˆ¿ éµè¼ªï¼Œé«”é©—ç”¨æº«æ³‰è’¸æ°£è’¸æµ·é®®ã€è”¬èœã€‚", icon: "ğŸ¥š" },
                        { time: "14:40", title: "ç§»å‹•ï¼šç”±å¸ƒé™¢ä¹‹æ£®", type: "transport", desc: "æ­ä¹˜å¤¢å¹»è§€å…‰åˆ—è»Šã€Œç”±å¸ƒé™¢ä¹‹æ£® 4è™Ÿã€è¿”å›åšå¤š (ç´„17:35æŠµé”)ã€‚*å‹™å¿…æå‰åŠƒä½ï¼*", icon: "ğŸš‚", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/JRK_Kiha72_Yufuin-no-mori_Kyudai_Line.jpg/640px-JRK_Kiha72_Yufuin-no-mori_Kyudai_Line.jpg" },
                        { time: "18:00", title: "é£¯åº— Check-in", type: "stay", desc: "ä¸‰äº•èŠ±åœ’é£¯åº—ç¦å²¡ç¥‡åœ’ï¼Œä¼‘æ¯æ•´ç†ã€‚", icon: "ğŸ¨" },
                        { time: "19:00", title: "æ™šé¤ï¼šè—¥é™¢ç‡’è‚‰", type: "food", desc: "å‰å¾€ç‡’è‚‰æ¿€æˆ°å€ã€Œè—¥é™¢ã€ã€‚æ¨è–¦ï¼šNikuichi (ã«ãã„ã¡) æˆ– Bakuro (è¨˜å¾—æå‰é ç´„ï¼)", icon: "ğŸ¥©" }
                    ]
                },
                {
                    day: 4,
                    title: "æŸ³å·éŠèˆ¹ & å¤ªå®°åºœé›™åŸéŠ",
                    focus: "æŸ³å·éŠèˆ¹ã€ä¸€è˜­æ‹‰éºµã€å¤ªå®°åºœå¤©æ»¿å®®ã€å¤©ç¥æ•£ç­–ã€ç“¢ç°å£½å¸",
                    tags: ["æ°´é„‰", "æ‹‰éºµ", "æ•£ç­–"],
                    activities: [
                        { time: "09:00", title: "å‰å¾€å¤©ç¥è³¼ç¥¨", type: "transport", desc: "æ­åœ°éµè‡³å¤©ç¥ç«™ï¼Œè³¼è²·ã€Œå¤ªå®°åºœæŸ³å·è§€å…‰å¥—ç¥¨ã€å¾Œæ­ä¹˜è¥¿éµé›»è»Šã€‚", icon: "ğŸš‡" },
                        { time: "10:30", title: "æŸ³å·éŠèˆ¹ (å·ä¸‹ã‚Š)", type: "sightseeing", desc: "é«”é©—å……æ»¿è©©æ„çš„é‹æ²³å°èˆŸï¼Œè½èˆ¹å¤«å“¼å”±å°èª¿ã€‚", icon: "ğŸ›¶", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Yanagawa_kawatudari.JPG/640px-Yanagawa_kawatudari.JPG" },
                        { time: "12:30", title: "ç§»å‹•ï¼šå‰å¾€å¤ªå®°åºœ", type: "transport", desc: "æŸ³å· â†’ å¤ªå®°åºœ (é›»è»Šç´„ 50 åˆ†é˜)ã€‚", icon: "ğŸšŒ" },
                        { time: "13:30", title: "åˆé¤ï¼šä¸€è˜­æ‹‰éºµ", type: "food", desc: "å¤ªå®°åºœåƒé“åº—ï¼Œç‰¹è‰²æ˜¯äº”è§’å½¢åˆæ ¼ç¢— (Gokaku Ramen)ã€‚", icon: "ğŸœ" },
                        { time: "14:30", title: "å¤ªå®°åºœå¤©æ»¿å®®", type: "sightseeing", desc: "åƒæ‹œå­¸å•ä¹‹ç¥ã€æ‘¸å¾¡ç¥ç‰›ã€åƒæ¢…æé¤…ã€‚åƒè§€éšˆç ”å¾æ˜Ÿå·´å…‹ã€‚", icon: "â›©ï¸", image: "https://upload.wikimedia.org/wikipedia/commons/a/a4/Dazaifu_Tenman-gu_Honden.jpg" },
                        { time: "17:30", title: "å¤©ç¥æ•£ç­–", type: "sightseeing", desc: "å›åˆ°å¤©ç¥ï¼Œæ¼«æ­¥å¤§å (Daimyo) å€åŸŸçš„å°å··å¼„ï¼Œæ„Ÿå—æ½®æµæ°›åœ (ä¸éœ€è¡€æ‹¼)ã€‚", icon: "ğŸš¶" },
                        { time: "19:00", title: "æ™šé¤ï¼šç“¢ç°å£½å¸", type: "food", desc: "Hyotan Sushiï¼Œå¤©ç¥è¶…äººæ°£æ’éšŠååº—ï¼Œé£Ÿææ–°é®® CP å€¼é«˜ï¼", icon: "ğŸ£" }
                    ]
                },
                {
                    day: 5,
                    title: "ç¦å²¡ç¾æ™¯ï¼šå¤§æ¿ å…¬åœ’ & æ°´ç‚Šé‹",
                    focus: "æ«›ç”°ç¥ç¤¾ã€å¤§æ¿ å…¬åœ’ä¸‹åˆèŒ¶ã€ç¦å²¡å¡”å¤•é™½ã€æ°´ç‚Šé‹",
                    tags: ["ç¾æ™¯", "ä¸‹åˆèŒ¶", "é‹ç‰©"],
                    activities: [
                        { time: "10:00", title: "æ«›ç”°ç¥ç¤¾", type: "sightseeing", desc: "é£¯åº—æ­¥è¡Œå³é”ï¼Œåšå¤šçš„å®ˆè­·ç¥ï¼Œå¿…çœ‹å·¨å¤§è£é£¾å±±ç¬ ã€‚", icon: "â›©ï¸" },
                        { time: "11:00", title: "å·ç«¯é€šå•†åº—è¡—", type: "sightseeing", desc: "å……æ»¿åœ¨åœ°ç”Ÿæ´»æ„Ÿçš„å•†åº—è¡—ã€‚åˆé¤å¯åƒ å·ç«¯å–„å“‰å»£å ´ ç´…è±†æ¹¯ã€‚", icon: "ğŸš¶" },
                        { time: "13:30", title: "å¤§æ¿ å…¬åœ’ & ç¾è¡“é¤¨", type: "sightseeing", desc: "æ­åœ°éµè‡³ã€Œå¤§æ¿ å…¬åœ’ç«™ã€ã€‚æ¹–é‚Šæ•£æ­¥ï¼Œåƒè§€ç¦å²¡å¸‚ç¾è¡“é¤¨ (è‰é–“å½Œç”Ÿå—ç“œ)ã€‚", icon: "ğŸ¦¢", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Ohori_Park_04.JPG/640px-Ohori_Park_04.JPG" },
                        { time: "15:00", title: "æ¹–ç•”ä¸‹åˆèŒ¶", type: "food", desc: "æ¨è–¦ï¼š&LOCALS (æ—¥å¼æœ€ä¸­é¤…/èŒ¶é£²)ï¼Œååœ¨ç»ç’ƒå±‹å…§æ¬£è³æ¹–æ™¯ã€‚", icon: "â˜•" },
                        { time: "17:00", title: "ç¦å²¡å¡” & ç™¾é“æ¿±", type: "sightseeing", desc: "æ­å·´å£«å‰å¾€ï¼Œç™»ä¸Šç¦å²¡å¡”çœ‹å¤•é™½èˆ‡å¤œæ™¯ï¼Œæˆ–åœ¨æµ·é‚Šæ•™å ‚æ‹ç…§ã€‚", icon: "ğŸ—¼", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c0/Fukuoka_Tower_October_2011_01.jpg/800px-Fukuoka_Tower_October_2011_01.jpg" },
                        { time: "19:30", title: "æ™šé¤ï¼šæ°´ç‚Šé‹", type: "food", desc: "æ°´ç‚Šã æ©™ (Daidai)ï¼Œç±³å…¶æ—å¿…æ¯”ç™»æ¨è–¦ï¼Œæ¹¯é ­è¶…æ¿ƒéƒï¼(éœ€é ç´„)", icon: "ğŸ¥˜" }
                    ]
                },
                {
                    day: 6,
                    title: "æœ€å¾Œè¡åˆº & å¿«æ¨‚è¿”å®¶",
                    focus: "æ‚ é–’é€€æˆ¿ã€æ©Ÿå ´å…ç¨…åº—æƒè²¨",
                    tags: ["è³¼ç‰©", "è¿”ç¨‹"],
                    activities: [
                        { time: "10:00", title: "æ‚ é–’é€€æˆ¿ Check-out", type: "transport", desc: "ä¸ç”¨è¶•è¡Œç¨‹ï¼Œå¸¶è‘—è¡Œæç›´æ¥å‰å¾€ç¦å²¡æ©Ÿå ´ã€‚", icon: "ğŸ‘‹" },
                        { time: "10:40", title: "æŠµé”æ©Ÿå ´ (åœ‹éš›ç·š)", type: "transport", desc: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒã€è¨—é‹è¡Œæã€‚", icon: "ğŸ›¬" },
                        { time: "11:30", title: "å…ç¨…åº—æœ€å¾Œæƒè²¨", type: "sightseeing", desc: "ç¦å²¡æ©Ÿå ´å…ç¨…åº—éå¸¸å¥½é€›ï¼Œä¹å·åç”¢ä¸€ç¶²æ‰“ç›¡ã€‚å¿…è²·ï¼šç¦ç ‚å±‹é•·å´è›‹ç³•ã€åšå¤šé€šé¥…é ­ã€Menbei ä»™è²ã€Royceã€‚", icon: "ğŸ", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Karashi_Mentaiko_001.jpg/640px-Karashi_Mentaiko_001.jpg" },
                        { time: "12:30", title: "æœ€å¾Œåˆé¤", type: "food", desc: "åœ¨æ©Ÿå ´äº«ç”¨æœ€å¾Œçš„æ—¥æœ¬ç¾é£Ÿã€‚", icon: "ğŸœ" },
                        { time: "15:55", title: "èµ·é£›", type: "transport", desc: "å¸¶è‘—æ»¿æ»¿çš„å›æ†¶èˆ‡æˆ°åˆ©å“å›å®¶ã€‚", icon: "âœˆï¸" }
                    ]
                }
            ],
            packingList: [
                "è­·ç…§ (æ•ˆæœŸéœ€6å€‹æœˆä»¥ä¸Š)",
                "VJW (Visit Japan Web) æˆªåœ–",
                "æ—¥å¹£ç¾é‡‘ (å±‹å°/äº¤é€šå¡ç”¨)",
                "è¡Œå‹•é›»æº & å……é›»ç·š",
                "ç¶²å¡ / Roaming",
                "å¥½èµ°çš„é‹å­ (æ­¥æ•¸å¾ˆå¤š)",
                "è¼•ä¾¿è³¼ç‰©è¢‹ (ç’°ä¿è¢‹)"
            ]
        };

        // --- Logic ---
        let tripData = JSON.parse(localStorage.getItem('kyushu_trip_data')) || defaultTripData;
        let currentView = 'info';
        let currentDayIndex = 0;
        let activeFilter = 'all';
        let isEditMode = false;

        const mainContent = document.getElementById('main-content');
        const dayNav = document.getElementById('day-nav');
        const packingListEl = document.getElementById('packing-list-sidebar');
        const packProgressEl = document.getElementById('pack-progress');
        const addPackItemContainer = document.getElementById('add-pack-item-container');

        document.addEventListener('DOMContentLoaded', () => {
            renderDayNav();
            renderPackingList();
            switchView('info');
        });

        // --- View Switching ---
        window.switchView = (view) => {
            currentView = view;
            const buttons = document.querySelectorAll('nav button');
            buttons.forEach(btn => {
                if((view === 'info' && btn.innerText.includes('é‡é»')) || 
                   (view === 'itinerary' && btn.innerText.includes('è¡Œç¨‹')) ||
                   (view === 'souvenir' && btn.innerText.includes('ä¼´æ‰‹ç¦®'))) {
                    btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.add('bg-orange-100', 'text-orange-700', 'border-transparent');
                } else {
                    btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.remove('bg-orange-100', 'text-orange-700', 'border-transparent');
                }
            });

            if (view === 'info') renderInfo();
            else if (view === 'souvenir') renderSouvenir();
            else renderItinerary(currentDayIndex);
        };

        function renderDayNav() {
            dayNav.innerHTML = tripData.days.map((d, index) => `
                <button onclick="selectDay(${index})" 
                    class="day-btn flex-shrink-0 w-full text-left px-3 py-2 rounded-lg border border-orange-100 hover:bg-orange-50 transition flex flex-col justify-center items-center text-center group ${index === 0 ? 'bg-orange-50 border-orange-200 ring-1 ring-orange-200' : 'bg-white'}"
                    id="day-btn-${index}">
                    <span class="text-xs font-bold text-orange-500 uppercase">Day ${d.day}</span>
                    <h4 class="font-bold text-gray-700 text-xs truncate w-full group-hover:text-orange-700">${d.title.split('&')[0]}</h4>
                </button>
            `).join('');
        }

        window.selectDay = (index) => {
            currentDayIndex = index;
            document.querySelectorAll('.day-btn').forEach((btn, idx) => {
                if (idx === index) {
                    btn.classList.add('bg-orange-50', 'border-orange-200', 'ring-1', 'ring-orange-200');
                    btn.classList.remove('bg-white');
                } else {
                    btn.classList.remove('bg-orange-50', 'border-orange-200', 'ring-1', 'ring-orange-200');
                    btn.classList.add('bg-white');
                }
            });
            switchView('itinerary');
        };

        // --- Editing Logic ---
        window.toggleEditMode = () => {
            isEditMode = !isEditMode;
            const btn = document.getElementById('edit-toggle-btn');
            if (isEditMode) {
                btn.classList.replace('bg-blue-600', 'bg-green-600');
                btn.innerText = 'ğŸ’¾ å„²å­˜ä¿®æ”¹';
                addPackItemContainer.classList.remove('hidden');
            } else {
                btn.classList.replace('bg-green-600', 'bg-blue-600');
                btn.innerText = 'âœï¸ ç·¨è¼¯è¡Œç¨‹';
                addPackItemContainer.classList.add('hidden');
                saveData(); // Save on exit edit mode
            }
            // Refresh current view
            if (currentView === 'itinerary') renderItinerary(currentDayIndex);
            else renderPackingList(); // Re-render packing list to show delete buttons
        };

        function saveData() {
            localStorage.setItem('kyushu_trip_data', JSON.stringify(tripData));
        }

        window.downloadJson = () => {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tripData));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "kyushu_trip_data.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        };

        window.uploadJson = (input) => {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    tripData = JSON.parse(e.target.result);
                    saveData();
                    location.reload();
                } catch (err) {
                    alert("æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼");
                }
            };
            reader.readAsText(file);
        };

        // --- Packing List ---
        function renderPackingList() {
            const savedChecks = JSON.parse(localStorage.getItem('packChecks')) || {};
            let checkedCount = 0;
            packingListEl.innerHTML = tripData.packingList.map((item, idx) => {
                const isChecked = savedChecks[idx] ? 'checked' : '';
                if(isChecked) checkedCount++;
                
                let deleteBtn = isEditMode ? `<span class="text-red-500 cursor-pointer ml-auto text-xs" onclick="deletePackItem(${idx})">âŒ</span>` : '';

                return `
                <li class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer transition">
                    <div onclick="togglePack(${idx})" class="w-5 h-5 rounded border ${isChecked ? 'bg-green-500 border-green-500' : 'border-gray-300'} flex items-center justify-center text-white text-xs transition-colors">
                        ${isChecked ? 'âœ“' : ''}
                    </div>
                    <span onclick="togglePack(${idx})" class="${isChecked ? 'line-through text-gray-400' : 'text-gray-600'} flex-1">${item}</span>
                    ${deleteBtn}
                </li>
            `}).join('');
            packProgressEl.innerText = `${checkedCount}/${tripData.packingList.length}`;
        }

        window.togglePack = (idx) => {
            if (isEditMode) return; // Disable toggle in edit mode to prevent conflict
            const savedChecks = JSON.parse(localStorage.getItem('packChecks')) || {};
            savedChecks[idx] = !savedChecks[idx];
            localStorage.setItem('packChecks', JSON.stringify(savedChecks));
            renderPackingList();
        };

        window.addPackItem = () => {
            const input = document.getElementById('new-pack-item');
            const val = input.value.trim();
            if (val) {
                tripData.packingList.push(val);
                input.value = '';
                saveData();
                renderPackingList();
            }
        };

        window.deletePackItem = (idx) => {
            tripData.packingList.splice(idx, 1);
            saveData();
            renderPackingList();
        };

        // --- Render Views ---

        function renderInfo() {
            const template = document.getElementById('info-template').content.cloneNode(true);
            mainContent.innerHTML = '';
            mainContent.appendChild(template);
        }

        function renderSouvenir() {
            const template = document.getElementById('souvenir-template').content.cloneNode(true);
            mainContent.innerHTML = '';
            mainContent.appendChild(template);
        }

        function renderItinerary(dayIndex) {
            const dayData = tripData.days[dayIndex];
            const template = document.getElementById('itinerary-template').content.cloneNode(true);
            
            // Header
            if (isEditMode) {
                template.querySelector('#day-title').innerHTML = `<input type="text" value="${dayData.title}" class="edit-input text-2xl font-bold" onchange="updateDay(${dayIndex}, 'title', this.value)">`;
                template.querySelector('#day-desc').innerHTML = `<textarea class="edit-input edit-textarea" onchange="updateDay(${dayIndex}, 'focus', this.value)">${dayData.focus}</textarea>`;
            } else {
                template.querySelector('#day-title').innerText = `Day ${dayData.day}: ${dayData.title}`;
                template.querySelector('#day-desc').innerText = dayData.focus;
            }
            template.querySelector('#day-tags').innerHTML = dayData.tags.map(t => 
                `<span class="bg-white/80 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-gray-600 shadow-sm">#${t}</span>`
            ).join('');

            const timelineContainer = template.querySelector('#timeline-container');
            const filteredActivities = activeFilter === 'all' 
                ? dayData.activities 
                : dayData.activities.filter(a => a.type === activeFilter);

            timelineContainer.innerHTML = filteredActivities.map((act, actIdx) => {
                let typeColor = 'bg-gray-100 text-gray-600';
                let typeBorder = 'border-gray-200';
                if (act.type === 'food') { typeColor = 'bg-red-50 text-red-600'; typeBorder = 'border-red-200'; }
                if (act.type === 'sightseeing') { typeColor = 'bg-green-50 text-green-600'; typeBorder = 'border-green-200'; }
                if (act.type === 'transport') { typeColor = 'bg-blue-50 text-blue-600'; typeBorder = 'border-blue-200'; }
                
                let contentHtml = '';
                if (isEditMode) {
                    contentHtml = `
                        <div class="space-y-2">
                            <div class="flex gap-2">
                                <input type="text" value="${act.time}" class="edit-input w-20" onchange="updateActivity(${dayIndex}, ${actIdx}, 'time', this.value)">
                                <select class="edit-input w-24" onchange="updateActivity(${dayIndex}, ${actIdx}, 'icon', this.value)">
                                    <option value="ğŸœ" ${act.icon==='ğŸœ'?'selected':''}>ğŸœ</option>
                                    <option value="ğŸš„" ${act.icon==='ğŸš„'?'selected':''}>ğŸš„</option>
                                    <option value="ğŸ¨" ${act.icon==='ğŸ¨'?'selected':''}>ğŸ¨</option>
                                    <option value="ğŸ“¸" ${act.icon==='ğŸ“¸'?'selected':''}>ğŸ“¸</option>
                                    <option value="ğŸµ" ${act.icon==='ğŸµ'?'selected':''}>ğŸµ</option>
                                    <option value="ğŸ›ï¸" ${act.icon==='ğŸ›ï¸'?'selected':''}>ğŸ›ï¸</option>
                                </select>
                            </div>
                            <input type="text" value="${act.title}" class="edit-input font-bold" onchange="updateActivity(${dayIndex}, ${actIdx}, 'title', this.value)">
                            <textarea class="edit-input edit-textarea" onchange="updateActivity(${dayIndex}, ${actIdx}, 'desc', this.value)">${act.desc}</textarea>
                            <input type="text" value="${act.image || ''}" placeholder="åœ–ç‰‡ç¶²å€(é¸å¡«)" class="edit-input text-xs" onchange="updateActivity(${dayIndex}, ${actIdx}, 'image', this.value)">
                            <select class="edit-input" onchange="updateActivity(${dayIndex}, ${actIdx}, 'type', this.value)">
                                <option value="food" ${act.type==='food'?'selected':''}>ç¾é£Ÿ</option>
                                <option value="sightseeing" ${act.type==='sightseeing'?'selected':''}>æ™¯é»</option>
                                <option value="transport" ${act.type==='transport'?'selected':''}>äº¤é€š</option>
                                <option value="stay" ${act.type==='stay'?'selected':''}>ä½å®¿</option>
                            </select>
                        </div>
                        <div class="delete-btn" onclick="deleteActivity(${dayIndex}, ${actIdx})">âœ•</div>
                    `;
                } else {
                    let imageHtml = '';
                    if (act.image) {
                        imageHtml = `
                        <div class="mt-3 h-32 w-full sketch-img-container">
                            <img src="${act.image}" alt="${act.title}" class="ghibli-filter" onerror="imgError(this)">
                        </div>`;
                    }
                    contentHtml = `
                        <h4 class="font-bold text-gray-800 text-lg">${act.title}</h4>
                        <p class="text-sm text-gray-500 mt-1 leading-relaxed">${act.desc}</p>
                        ${imageHtml}
                        <span class="inline-block mt-2 text-[10px] uppercase font-bold px-2 py-0.5 rounded ${typeColor}">
                            ${act.type === 'food' ? 'ç¾é£Ÿ' : act.type === 'transport' ? 'äº¤é€š' : act.type === 'stay' ? 'ä½å®¿' : 'è§€å…‰'}
                        </span>
                    `;
                }

                return `
                <div class="relative pl-2 md:pl-2 group mb-4">
                    <div class="absolute left-0 top-0 w-12 md:w-12 text-center">
                        <span class="text-sm font-bold text-gray-400 font-mono group-hover:text-orange-500 transition">${isEditMode ? '' : act.time}</span>
                    </div>
                    <div class="absolute left-[50px] md:left-[58px] top-1.5 w-3 h-3 bg-white border-2 border-orange-300 rounded-full z-10 group-hover:scale-125 group-hover:bg-orange-500 transition"></div>
                    <div class="bg-white rounded-xl p-4 border ${typeBorder} shadow-sm hover-card ml-[60px] md:ml-[70px] relative">
                        <div class="flex items-start gap-3">
                            ${!isEditMode ? `<span class="text-2xl">${act.icon}</span>` : ''}
                            <div class="flex-1">
                                ${contentHtml}
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');

            // Add Activity Button
            if (isEditMode) {
                template.getElementById('add-activity-btn').classList.remove('hidden');
            }

            // Footer Nav
            const navFooter = template.querySelector('#timeline-nav-footer');
            if (!isEditMode) {
                let footerHtml = '';
                if (dayIndex > 0) {
                    footerHtml += `<button onclick="selectDay(${dayIndex - 1})" class="flex items-center gap-2 text-gray-500 hover:text-orange-600 transition group cursor-pointer"><span class="text-lg group-hover:-translate-x-1 transition">â†</span><div class="text-left"><div class="text-xs font-bold text-gray-400">ä¸Šä¸€å¤©</div><div class="text-sm font-bold">Day ${tripData.days[dayIndex - 1].day}</div></div></button>`;
                } else { footerHtml += `<div></div>`; }
                if (dayIndex < tripData.days.length - 1) {
                    footerHtml += `<button onclick="selectDay(${dayIndex + 1})" class="flex items-center gap-3 bg-orange-100 hover:bg-orange-200 text-orange-800 px-5 py-3 rounded-xl transition group shadow-sm cursor-pointer transform hover:scale-105 active:scale-95"><div class="text-right"><div class="text-xs font-bold text-orange-600 uppercase tracking-wide">å‰å¾€ä¸‹ä¸€å¤©</div><div class="text-lg font-bold">Day ${tripData.days[dayIndex + 1].day}</div></div><span class="text-xl group-hover:translate-x-1 transition">â†’</span></button>`;
                }
                navFooter.innerHTML = footerHtml;
            } else {
                navFooter.innerHTML = '';
            }

            mainContent.innerHTML = '';
            mainContent.appendChild(template);
        }

        // --- Data Update Functions ---
        window.updateDay = (dayIndex, field, value) => {
            tripData.days[dayIndex][field] = value;
            // Don't save yet, wait for exit edit mode
        };

        window.updateActivity = (dayIndex, actIndex, field, value) => {
            tripData.days[dayIndex].activities[actIndex][field] = value;
        };

        window.deleteActivity = (dayIndex, actIndex) => {
            if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {
                tripData.days[dayIndex].activities.splice(actIndex, 1);
                renderItinerary(dayIndex);
            }
        };

        window.addActivity = () => {
            tripData.days[currentDayIndex].activities.push({
                time: "12:00", title: "æ–°è¡Œç¨‹", type: "sightseeing", desc: "è«‹è¼¸å…¥èªªæ˜", icon: "ğŸ“"
            });
            renderItinerary(currentDayIndex);
        };

        // --- AI Chat Logic ---
        const apiKey = ""; 

        function toggleChat() {
            const widget = document.getElementById('chat-widget');
            if (widget.style.display === 'none' || widget.style.display === '') {
                widget.style.display = 'flex';
                setTimeout(() => document.getElementById('user-input').focus(), 300);
            } else {
                widget.style.display = 'none';
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addMessage(text, type) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.innerHTML = text.replace(/\n/g, '<br>');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user-msg');
            input.value = '';

            const indicator = document.getElementById('typing-indicator');
            indicator.style.display = 'block';

            // Clean context
            const tripContext = JSON.stringify(tripData);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are a helpful travel assistant for a Kyushu, Japan trip. 
                                The user's itinerary data is:
                                ---
                                ${tripContext}
                                ---
                                User Question: ${message}
                                
                                Instructions:
                                1. Answer based on the itinerary data provided.
                                2. Be concise, friendly, and helpful.
                                3. If asked for translations, provide Japanese text and pronunciation.
                                4. Respond in Traditional Chinese (ç¹é«”ä¸­æ–‡).`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                indicator.style.display = 'none';
                addMessage(aiResponse, 'ai-msg');

            } catch (error) {
                console.error('Error:', error);
                indicator.style.display = 'none';
                addMessage("æŠ±æ­‰ï¼Œæˆ‘ç¾åœ¨æœ‰é»å¿™ç¢Œï¼Œè«‹ç¨å¾Œå†è©¦ä¸€æ¬¡ï¼(API Error)", 'ai-msg');
            }
        }
    </script>
</body>
</html>
